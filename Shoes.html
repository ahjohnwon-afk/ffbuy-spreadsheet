<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoes - $FFBuy SpreadSheet</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

</head>
<body>
    <header>
        <a href="index.html" class="logo">$FFBuy SpreadSheet</a>
        <div class="search-container">
            <input type="text" class="search-box" placeholder="Search products...">
            <span class="search-icon"><i class="fas fa-search"></i></span>
        </div>
        <div class="nav-links">
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="#"><i class="fas fa-th-large"></i> All Categories <i class="fas fa-chevron-down"></i></a>
        </div>
        <div class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </div>
    </header>

    <nav>
        <a href="HOT PRODUCTS.html"><i class="fas fa-fire"></i> HOT PRODUCTS</a>
        <a href="T-Shirt.html"><i class="fas fa-tshirt"></i> T-Shirt</a>
        <a href="Pants.html"><i class="fas fa-socks"></i> Pants</a>
        <a href="Shoes.html" class="active"><i class="fas fa-shoe-prints"></i> Shoes</a>
        <a href="Set.html"><i class="fas fa-layer-group"></i> Set</a>
        <a href="Accessories.html"><i class="fas fa-gem"></i> Accessories</a>
        <a href="Hoodie Sweatshirt.html"><i class="fas fa-tshirt"></i> Hoodie/Sweatshirt</a>
        <a href="ELECTRONICOS.html"><i class="fas fa-laptop"></i> ELECTRONICOS</a>
    </nav>

    <div class="container">
        <div class="products-grid" id="products-container">
            <!-- Products will be loaded dynamically from JSON data -->
            <div class="loading-indicator">
                <i class="fas fa-spinner fa-spin"></i> 正在加载产品数据...
            </div>
        </div>
    </div>

    <img src="img/ws.png" alt="WhatsApp" class="chat-button">

<div class="floating-buttons">
    <img src="img/telegram.png" alt="Telegram" class="telegram-icon">
    <div class="float-btn back-to-top"><i class="fas fa-arrow-up"></i></div>
</div>

<script>
    // Document ready function
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch products from JSON API
        fetchProducts();
        
        // Chat button functionality
        const chatButton = document.querySelector('.chat-button');
        if (chatButton) {
            chatButton.addEventListener('click', function() {
                window.open('https://wa.me/message/INCWNKPORGSSN1', '_blank');
            });
        }
        
        // Product filter functionality
        const searchBox = document.querySelector('.search-box');
        
        searchBox.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const title = card.querySelector('.product-title').textContent.toLowerCase();
                
                if (title.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Mobile menu functionality
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const nav = document.querySelector('nav');
        
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', function() {
                nav.classList.toggle('active');
                // Toggle icon between bars and times
                const icon = this.querySelector('i');
                if (icon.classList.contains('fa-bars')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!nav.contains(event.target) && !mobileMenuBtn.contains(event.target) && nav.classList.contains('active')) {
                    nav.classList.remove('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
            
            // Close menu when clicking on a nav link
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    nav.classList.remove('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                });
            });
        }
        
        // Back to top button functionality
        const backToTopBtn = document.querySelector('.back-to-top');
        
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // Show/hide back to top button based on scroll position
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTopBtn.style.opacity = '1';
            } else {
                backToTopBtn.style.opacity = '0.7';
            }
        });
        
        // Telegram icon functionality
        const telegramIcon = document.querySelector('.telegram-icon');
        
        telegramIcon.addEventListener('click', function() {
            window.open('https://t.me/cnw2cfind', '_blank');
        });
    });
    
    // Function to fetch products from JSON API
    function fetchProducts() {
        const productsContainer = document.getElementById('products-container');
        const loadingIndicator = document.querySelector('.loading-indicator');
        const apiUrl = 'https://opensheet.elk.sh/1hs4cXFLQRhdR8MfQ0vt0oMXhXplksGbU9vzkhO46J6A/Shoes';
        
        // 创建一个单独的加载指示器，不会阻止页面交互
        if (!loadingIndicator) {
            const indicator = document.createElement('div');
            indicator.className = 'loading-indicator';
            indicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在加载产品数据...';
            productsContainer.appendChild(indicator);
        }
        
        // 设置超时，如果API请求时间过长，显示部分UI
        const timeoutPromise = new Promise((_, reject) => {
            setTimeout(() => {
                reject(new Error('请求超时，请检查网络连接'));
            }, 10000); // 10秒超时
        });
        
        // 使用Promise.race在超时和正常请求之间竞争
        Promise.race([fetch(apiUrl), timeoutPromise])
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // 移除加载指示器，保留其他内容
                const loadingIndicator = document.querySelector('.loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
                
                // Process and display the products
                data.forEach((product, index) => {
                    if (product.spbt && product.ztURL && product.spURL) {
                        const productCard = document.createElement('div');
                        productCard.className = 'product-card';
                        productCard.style.animationDelay = `${index * 0.03}s`;
                        productCard.classList.add('fade-in');
                        
                        // Create product HTML
                        productCard.innerHTML = `
                            <a href="${product.spURL}" target="_blank">
                                <img src="${product.ztURL}" class="product-image" alt="${product.spbt}">
                                <div class="product-info">
                                    <div class="product-title">${product.spbt}</div>
                                    <div class="product-price">
                                        <div>
                                            <span class="us-price">${product.US || '--'}</span>
                                            <span class="eur-price">${product.EUR || '--'}</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        `;
                        
                        productsContainer.appendChild(productCard);
                    }
                });
                
                // If no products were added, show a message
                if (productsContainer.children.length === 0 || (productsContainer.children.length === 1 && productsContainer.children[0].classList.contains('loading-indicator'))) {
                    productsContainer.innerHTML = '<div class="no-products">暂无产品数据</div>';
                }
            })
            .catch(error => {
                console.error('Error fetching products:', error);
                productsContainer.innerHTML = `<div class="error-message">加载产品数据失败: ${error.message}</div>`;
            });
    }
</script>
</body>
</html>